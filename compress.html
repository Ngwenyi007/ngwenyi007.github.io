<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Video Compressor</title>
</head>
<body>
  <h2>Select Video to Compress</h2>
  <input type="file" id="uploader" accept="video/*" />
  <button onclick="handleCompress()">Compress</button>
  <br><br>
  <video id="videoPreview" controls style="max-width: 100%;"></video>
  <br><br>
  <a id="downloadLink" download="compressed.mp4" style="display:none;">Download Compressed Video</a>

  <script src="https://unpkg.com/@ffmpeg/ffmpeg@0.12.4/dist/ffmpeg.min.js"></script>
  <script>
    async function handleCompress() {
      const { createFFmpeg, fetchFile } = FFmpeg;
      const ffmpeg = createFFmpeg({ log: true });

      const file = document.getElementById('uploader').files[0];
      if (!file) return alert("Please select a video.");

      await ffmpeg.load();
      ffmpeg.FS('writeFile', 'input.mp4', await fetchFile(file));
      await ffmpeg.run('-i', 'input.mp4', '-vcodec', 'libx264', '-crf', '28', 'output.mp4');

      const data = ffmpeg.FS('readFile', 'output.mp4');
      const videoBlob = new Blob([data.buffer], { type: 'video/mp4' });
      const videoURL = URL.createObjectURL(videoBlob);

      document.getElementById('videoPreview').src = videoURL;
      const downloadLink = document.getElementById('downloadLink');
      downloadLink.href = videoURL;
      downloadLink.style.display = 'inline-block';
    }
  </script>
</body>
</html>
